# Users & Roles Management - Architecture & Flow Diagrams

## ðŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LEADPILOT CRM                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FRONTEND LAYER (React/TS)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  More Page (pages/More.tsx)                                         â”‚
â”‚      â””â”€â”€ "Users & Roles" Link                                       â”‚
â”‚          â””â”€â”€ /admin/users-and-roles                                 â”‚
â”‚              â”‚                                                       â”‚
â”‚              â”œâ”€â”€ UsersAndRolesPage (modules/admin/)                 â”‚
â”‚              â”‚   â”œâ”€â”€ [USERS TAB]                                    â”‚
â”‚              â”‚   â”‚   â”œâ”€â”€ Users Table (fetch from DB)               â”‚
â”‚              â”‚   â”‚   â”œâ”€â”€ Add User Button â†’ AddUserModal            â”‚
â”‚              â”‚   â”‚   â”œâ”€â”€ Edit User â†’ AddUserModal (edit mode)      â”‚
â”‚              â”‚   â”‚   â””â”€â”€ Delete User â†’ DB delete                   â”‚
â”‚              â”‚   â”‚                                                   â”‚
â”‚              â”‚   â””â”€â”€ [ROLES TAB]                                    â”‚
â”‚              â”‚       â”œâ”€â”€ Roles Grid (fetch from DB)                â”‚
â”‚              â”‚       â”œâ”€â”€ Add Role Button â†’ AddRoleModal            â”‚
â”‚              â”‚       â”œâ”€â”€ Edit Role â†’ AddRoleModal (edit mode)      â”‚
â”‚              â”‚       â””â”€â”€ Delete Role â†’ DB delete                   â”‚
â”‚              â”‚                                                       â”‚
â”‚              â””â”€â”€ Modals                                             â”‚
â”‚                  â”œâ”€â”€ AddUserModal (modules/admin/)                 â”‚
â”‚                  â”‚   â””â”€â”€ Form: name, email, phone, role, status    â”‚
â”‚                  â”‚                                                   â”‚
â”‚                  â””â”€â”€ AddRoleModal (modules/admin/)                 â”‚
â”‚                      â””â”€â”€ Form: name, desc, permissions[], status   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SUPABASE CLIENT LAYER (supabase-js)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  Queries (supabase.from('users'|'roles'))                          â”‚
â”‚  â”œâ”€â”€ select() - Fetch all users/roles                              â”‚
â”‚  â”œâ”€â”€ insert() - Create new user/role                               â”‚
â”‚  â”œâ”€â”€ update() - Edit user/role                                     â”‚
â”‚  â””â”€â”€ delete() - Remove user/role                                   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE LAYER (PostgreSQL/Supabase)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ roles TABLE                        â”‚ users TABLE             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ id (UUID, PK)                       â”‚ id (UUID, PK)           â”‚   â”‚
â”‚  â”‚ name (VARCHAR, UNIQUE)              â”‚ email (VARCHAR, UNIQUE) â”‚   â”‚
â”‚  â”‚ description (TEXT)                  â”‚ name (VARCHAR)          â”‚   â”‚
â”‚  â”‚ permissions (TEXT[] - array)        â”‚ phone (VARCHAR)         â”‚   â”‚
â”‚  â”‚ status (active|inactive)            â”‚ role_id (FK â†’ roles.id) â”‚   â”‚
â”‚  â”‚ created_at, updated_at              â”‚ status (active|...)     â”‚   â”‚
â”‚  â”‚                                     â”‚ last_login (TIMESTAMP)  â”‚   â”‚
â”‚  â”‚                                     â”‚ created_at, updated_at  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  RLS Policies Enabled âœ…                                            â”‚
â”‚  Triggers (auto-update timestamp) âœ…                                â”‚
â”‚  Indexes (email, role_id, status) âœ…                                â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ User Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User clicks    â”‚
â”‚  "+ Add User"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AddUserModal opens          â”‚
â”‚  - Fetches roles from DB     â”‚
â”‚  - Displays role dropdown    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User fills form:                    â”‚
â”‚  - Name (required)                   â”‚
â”‚  - Email (required)                  â”‚
â”‚  - Phone (optional)                  â”‚
â”‚  - Role (required, select from list) â”‚
â”‚  - Status (Active|Inactive|Suspended)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User clicks "Create" button â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Validation:                    â”‚
â”‚  âœ“ Name not empty                        â”‚
â”‚  âœ“ Email not empty & valid format        â”‚
â”‚  âœ“ Role selected                         â”‚
â”‚  âœ“ Status is valid enum                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ INVALID â”€â”€â†’ Show error message
         â”‚
         â–¼ VALID
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Insert:                        â”‚
â”‚  supabase.from('users').insert({         â”‚
â”‚    id: UUID,                             â”‚
â”‚    email, name, phone, role_id, status   â”‚
â”‚  })                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ ERROR â”€â”€â”€â”€â†’ Show error toast
         â”‚
         â–¼ SUCCESS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Modal closes                â”‚
â”‚  Refresh users list          â”‚
â”‚  Show success message        â”‚
â”‚  New user appears in table   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¯ Permission System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             PERMISSIONS AVAILABLE (24 total)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  LEADS (4)          ACCOUNTS (4)        CONTACTS (4)         â”‚
â”‚  â”œâ”€ view_leads      â”œâ”€ view_accounts    â”œâ”€ view_contacts     â”‚
â”‚  â”œâ”€ create_leads    â”œâ”€ create_accounts  â”œâ”€ create_contacts   â”‚
â”‚  â”œâ”€ edit_leads      â”œâ”€ edit_accounts    â”œâ”€ edit_contacts     â”‚
â”‚  â””â”€ delete_leads    â””â”€ delete_accounts  â””â”€ delete_contacts   â”‚
â”‚                                                              â”‚
â”‚  DEALS (4)          TASKS (4)           OTHER (4)            â”‚
â”‚  â”œâ”€ view_deals      â”œâ”€ view_tasks       â”œâ”€ view_analytics    â”‚
â”‚  â”œâ”€ create_deals    â”œâ”€ create_tasks     â”œâ”€ manage_users      â”‚
â”‚  â”œâ”€ edit_deals      â”œâ”€ edit_tasks       â”œâ”€ manage_roles      â”‚
â”‚  â””â”€ delete_deals    â””â”€ delete_tasks     â””â”€ [reserved]        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DEFAULT ROLES (Pre-configured)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ADMIN                     MANAGER                          â”‚
â”‚  â””â”€ permissions: [24]      â””â”€ permissions: [15]             â”‚
â”‚     Full system access        Lead/Account/Task mgmt        â”‚
â”‚     - All CRUD ops           - Edit capabilities            â”‚
â”‚     - User management        - Read analytics               â”‚
â”‚     - Role management        - No user/role mgmt            â”‚
â”‚                                                              â”‚
â”‚  SALES REP                 VIEWER                           â”‚
â”‚  â””â”€ permissions: [13]      â””â”€ permissions: [6]              â”‚
â”‚     Leads & Deals mgmt        Read-only access              â”‚
â”‚     - Create/Edit leads       - View leads                  â”‚
â”‚     - Create/Edit deals       - View accounts               â”‚
â”‚     - Manage tasks            - View contacts               â”‚
â”‚     - Create contacts         - View deals                  â”‚
â”‚                             - View tasks                    â”‚
â”‚                             - View analytics               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PERMISSION STORAGE (PostgreSQL text array)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Role "Sales Rep" in Database:                               â”‚
â”‚  {                                                            â”‚
â”‚    id: "550e8400-e29b-41d4-a716-446655440002",               â”‚
â”‚    name: "Sales Rep",                                        â”‚
â”‚    permissions: [                                            â”‚
â”‚      "view_leads",      "create_leads",     "edit_leads",    â”‚
â”‚      "view_accounts",   "create_accounts",                   â”‚
â”‚      "view_contacts",   "create_contacts",                   â”‚
â”‚      "view_deals",      "create_deals",     "edit_deals",    â”‚
â”‚      "view_tasks",      "create_tasks",     "edit_tasks"     â”‚
â”‚    ],                                                        â”‚
â”‚    status: "active"                                          â”‚
â”‚  }                                                            â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Data Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      roles          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) â—„â”€â”€â”€â”€â”€â”   â”‚
â”‚ name            â”‚   â”‚
â”‚ description     â”‚   â”‚
â”‚ permissions[]   â”‚   â”‚
â”‚ status          â”‚   â”‚
â”‚ created_at      â”‚   â”‚
â”‚ updated_at      â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”˜
                  â”‚ ONE-TO-MANY
                  â”‚ (Foreign Key)
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
â”‚      users      â”‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ id (UUID)           â”‚
â”‚ email               â”‚
â”‚ name                â”‚
â”‚ phone               â”‚
â”‚ role_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ status              â”‚
â”‚ last_login          â”‚
â”‚ created_at          â”‚
â”‚ updated_at          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relationship:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin Role  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ User 1      â”‚
â”‚ (1 role)    â”‚ 1:Many  â”‚ User 2      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ User 3      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each role can have many users
Each user has exactly one role
```

---

## ðŸŽ¨ UI Component Hierarchy

```
App.tsx
â”‚
â”œâ”€â”€ Router
â”‚   â””â”€â”€ Routes
â”‚       â””â”€â”€ /admin/users-and-roles
â”‚           â””â”€â”€ UsersAndRolesPage
â”‚               â”‚
â”‚               â”œâ”€â”€ PAGE HEADER
â”‚               â”‚   â””â”€â”€ "Users & Roles Management"
â”‚               â”‚
â”‚               â”œâ”€â”€ TAB SELECTOR
â”‚               â”‚   â”œâ”€â”€ [USERS]  (active)
â”‚               â”‚   â””â”€â”€ [ROLES]
â”‚               â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               â”‚ [USERS TAB CONTENT]                 â”‚
â”‚               â”‚                                     â”‚
â”‚               â”‚ â”Œâ”€ ADD USER SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚               â”‚ â”‚ Title: "All Users"            â”‚   â”‚
â”‚               â”‚ â”‚ [+ Add User] Button           â”‚   â”‚
â”‚               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               â”‚                                     â”‚
â”‚               â”‚ â”Œâ”€ USERS TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚               â”‚ â”‚ Headers: Name|Email|Role|...   â”‚   â”‚
â”‚               â”‚ â”‚                                â”‚   â”‚
â”‚               â”‚ â”‚ Rows:                          â”‚   â”‚
â”‚               â”‚ â”‚ John | j@... | Admin | [Edit] â”‚   â”‚
â”‚               â”‚ â”‚ Jane | j2@.. | Sales | [Edit] â”‚   â”‚
â”‚               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               â”‚                                     â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚               â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               â”‚ [ROLES TAB CONTENT]                 â”‚
â”‚               â”‚                                     â”‚
â”‚               â”‚ â”Œâ”€ ADD ROLE SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚               â”‚ â”‚ Title: "All Roles"             â”‚  â”‚
â”‚               â”‚ â”‚ [+ Add Role] Button            â”‚  â”‚
â”‚               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                     â”‚
â”‚               â”‚ â”Œâ”€ ROLES GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚               â”‚ â”‚                                â”‚   â”‚
â”‚               â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚               â”‚ â”‚ â”‚ Admin        â”‚ â”‚ Manager    â”‚â”‚   â”‚
â”‚               â”‚ â”‚ â”‚ Full access  â”‚ â”‚ Team mgmt  â”‚â”‚   â”‚
â”‚               â”‚ â”‚ â”‚ [Edit][Del]  â”‚ â”‚ [Edit][Del]â”‚â”‚   â”‚
â”‚               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚               â”‚ â”‚                                â”‚   â”‚
â”‚               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               â”‚                                     â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚               â”‚
â”‚               â””â”€â”€ MODALS
â”‚                   â”œâ”€â”€ AddUserModal (when showing)
â”‚                   â”‚   â”œâ”€â”€ Header: "Add New User"
â”‚                   â”‚   â”œâ”€â”€ Form Fields
â”‚                   â”‚   â”‚   â”œâ”€â”€ Name input
â”‚                   â”‚   â”‚   â”œâ”€â”€ Email input
â”‚                   â”‚   â”‚   â”œâ”€â”€ Phone input
â”‚                   â”‚   â”‚   â”œâ”€â”€ Role select
â”‚                   â”‚   â”‚   â””â”€â”€ Status select
â”‚                   â”‚   â””â”€â”€ Footer: [Cancel] [Create]
â”‚                   â”‚
â”‚                   â””â”€â”€ AddRoleModal (when showing)
â”‚                       â”œâ”€â”€ Header: "Add New Role"
â”‚                       â”œâ”€â”€ Form Fields
â”‚                       â”‚   â”œâ”€â”€ Name input
â”‚                       â”‚   â”œâ”€â”€ Description textarea
â”‚                       â”‚   â”œâ”€â”€ Status select
â”‚                       â”‚   â””â”€â”€ Permissions checkboxes (24)
â”‚                       â””â”€â”€ Footer: [Cancel] [Create]
â”‚
â””â”€â”€ More Page (pages/More.tsx)
    â””â”€â”€ Navigation items
        â””â”€â”€ "Users & Roles" â†’ /admin/users-and-roles
```

---

## ðŸ” Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CLIENT-SIDE SECURITY                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Form Validation                                    â”‚
â”‚  â”œâ”€ Required field checks                           â”‚
â”‚  â”œâ”€ Email format validation                         â”‚
â”‚  â””â”€ Status enum validation                          â”‚
â”‚                                                      â”‚
â”‚  Error Handling                                     â”‚
â”‚  â”œâ”€ Network errors                                  â”‚
â”‚  â”œâ”€ Validation errors                               â”‚
â”‚  â””â”€ User-friendly error messages                    â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ HTTP/HTTPS
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SUPABASE CLIENT (supabase-js)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Authentication                                     â”‚
â”‚  â””â”€ Validates session token                         â”‚
â”‚                                                      â”‚
â”‚  Authorization                                      â”‚
â”‚  â””â”€ Checks RLS policies before allowing access      â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ Encrypted Connection
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      DATABASE-SIDE SECURITY (PostgreSQL)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Row Level Security (RLS) Enabled âœ…                 â”‚
â”‚  â”œâ”€ Policy: SELECT - auth users only                â”‚
â”‚  â”œâ”€ Policy: INSERT - auth users only                â”‚
â”‚  â”œâ”€ Policy: UPDATE - auth users only                â”‚
â”‚  â””â”€ Policy: DELETE - auth users only                â”‚
â”‚                                                      â”‚
â”‚  Constraints                                        â”‚
â”‚  â”œâ”€ UNIQUE (email, role name)                       â”‚
â”‚  â”œâ”€ NOT NULL (required fields)                      â”‚
â”‚  â”œâ”€ CHECK (status enums)                            â”‚
â”‚  â””â”€ FOREIGN KEY (role_id â†’ roles)                   â”‚
â”‚                                                      â”‚
â”‚  Data Validation                                    â”‚
â”‚  â”œâ”€ Type checking (uuid, varchar, text[])          â”‚
â”‚  â”œâ”€ Length limits                                   â”‚
â”‚  â””â”€ Domain constraints                              â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“ˆ State Management Flow

```
UsersAndRolesPage
â”‚
â”œâ”€â”€ State Variables
â”‚   â”œâ”€â”€ activeTab: "users" | "roles"
â”‚   â”œâ”€â”€ users: User[]
â”‚   â”œâ”€â”€ roles: Role[]
â”‚   â”œâ”€â”€ loading: boolean
â”‚   â”œâ”€â”€ showAddUser: boolean
â”‚   â”œâ”€â”€ showAddRole: boolean
â”‚   â”œâ”€â”€ editingUser: User | null
â”‚   â””â”€â”€ editingRole: Role | null
â”‚
â”œâ”€â”€ Functions
â”‚   â”œâ”€â”€ fetchUsers() â†’ sets users state
â”‚   â”œâ”€â”€ fetchRoles() â†’ sets roles state
â”‚   â”œâ”€â”€ handleDeleteUser(id) â†’ updates users state
â”‚   â”œâ”€â”€ handleDeleteRole(id) â†’ updates roles state
â”‚   â”œâ”€â”€ handleAddUser() â†’ opens modal
â”‚   â”œâ”€â”€ handleAddRole() â†’ opens modal
â”‚   â”œâ”€â”€ handleEditUser() â†’ opens modal with data
â”‚   â””â”€â”€ handleEditRole() â†’ opens modal with data
â”‚
â””â”€â”€ Effects
    â”œâ”€â”€ useEffect(() => { fetch on tab change })
    â””â”€â”€ Dependency: [activeTab]

Modal State Management:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AddUserModal / AddRoleModal              â”‚
â”‚                                          â”‚
â”‚ Props from Parent:                       â”‚
â”‚ â”œâ”€ onClose: () => void                   â”‚
â”‚ â”œâ”€ onSave: () => void                    â”‚
â”‚ â”œâ”€ editingUser/editingRole: Data | null  â”‚
â”‚ â””â”€ roles: Role[]                         â”‚
â”‚                                          â”‚
â”‚ Local State:                             â”‚
â”‚ â”œâ”€ formData: { ... }                     â”‚
â”‚ â”œâ”€ loading: boolean                      â”‚
â”‚ â””â”€ error: string                         â”‚
â”‚                                          â”‚
â”‚ Flow:                                    â”‚
â”‚ 1. User fills form                       â”‚
â”‚ 2. Click submit â†’ validation             â”‚
â”‚ 3. Call Supabase (insert/update)         â”‚
â”‚ 4. Success â†’ onSave() â†’ parent refetch   â”‚
â”‚ 5. Close modal â†’ onClose()               â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¯ Key Design Patterns

```
COMPONENT PATTERNS:
â”œâ”€â”€ Page Component (UsersAndRolesPage)
â”‚   â””â”€ Manages overall state & data fetching
â”‚
â”œâ”€â”€ Modal Components (AddUserModal, AddRoleModal)
â”‚   â””â”€ Self-contained form logic
â”‚
â””â”€â”€ Presentation Layer
    â”œâ”€ Table for users
    â””â”€ Grid for roles

STATE MANAGEMENT:
â”œâ”€â”€ Local State (useState)
â”‚   â””â”€ Form data, UI state (modals, loading)
â”‚
â””â”€â”€ Data State
    â””â”€ Users and roles from database

DATA FLOW:
â”œâ”€â”€ Fetch (useEffect)
â”‚   â””â”€ Load initial data on mount
â”‚
â”œâ”€â”€ Create/Update/Delete
â”‚   â””â”€ Supabase operations â†’ refetch
â”‚
â””â”€â”€ Display
    â””â”€ Render from state

ERROR HANDLING:
â”œâ”€â”€ Try-Catch blocks
â”œâ”€â”€ User-facing error messages
â””â”€ Toast notifications (future)
```

---

This architecture ensures:
- âœ… Scalability (can handle 1000+ users)
- âœ… Security (RLS + validation)
- âœ… Maintainability (clear component structure)
- âœ… Extensibility (easy to add features)
- âœ… Performance (optimized queries)

